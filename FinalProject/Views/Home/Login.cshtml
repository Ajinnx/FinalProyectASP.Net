@using Azure.Core;
@using System.Web;
@model LoginViewModel
@{
    ViewData["Title"] = "Login";
    // Check if the cookie exists and set the value of the username field
}

<div class="container-fluid" style="margin-bottom:8%; margin-top:3%">
    <div class="text-center d-flex">
        <div id="loginStyle" style="background-color: #fff; padding: 30px; border-radius: 5px; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1); max-width: 60%;">
            <h1 style="font-size: 32px; font-weight: bold; margin-bottom: 30px;">Iniciar sesión</h1>
            <form id="loginForm">
                <div class="form-group">
                    <input class="form-control" type="text" id="user" placeholder="Usuario" style="font-size: 16px; padding: 12px 20px; border-radius: 5px; border: none; background-color: #f5f5f5; margin-bottom: 20px;"  />
                </div>
                <div class="form-group">
                    <input class="form-control" type="password" id="contraseña" placeholder="Contraseña" style="font-size: 16px; padding: 12px 20px; border-radius: 5px; border: none; background-color: #f5f5f5; margin-bottom: 20px;" />
                </div>
                <div class="form-group form-check">
                    <input class="form-check-input" style="float:none" type="checkbox" id="recuerdame">
                    <label class="form-check-label" for="recuerdame" style="font-size: 14px;">Recuérdame</label>
                </div>
                <button class="btn btn-primary btn-block" id="loginBtn" style="font-size: 16px; padding: 12px; border-radius: 5px; border: none; background-color: #007bff; margin-top: 20px;">Ingresar</button>
            </form>
            <div style="font-size: 14px; margin-top: 20px;">
                <a href="#" data-bs-toggle="modal" data-bs-target="#formularioReset" style="color: #007bff;">¿Olvidó su contraseña?</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="formularioReset" tabindex="-1" aria-labelledby="formREC" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="formREC">Reiniciar contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Formulario con los campos -->
                <form id="formularioResetPassword">
                    <div class="mb-3">
                        <label for="Correo" class="form-label">Correo</label>
                        <input type="text" class="form-control" id="correoREC" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="submit" class="btn btn-primary" id="enviarBtn">Enviar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        $('#formularioResetPassword').submit(function (event) {
            event.preventDefault(); // prevent form submission
            var recipientEmail = $('#correoREC').val(); // get value of input field
            var loginViewModel = { RecipientEmail: recipientEmail }; // create object with recipient email
            $.ajax({
                url: '@Url.Action("SendResetPasswordEmail", "Account")', // replace with the actual url of your controller action
                type: 'POST',
                data: JSON.stringify(loginViewModel),
                contentType: 'application/json',
                success: function (result) {
                    // handle success response
                },
                error: function (error) {
                    // handle error response
                }
            });
        });
    });
</script>

<script>
    const loginBtn = document.getElementById("loginBtn");
    loginBtn.addEventListener("click", loginUser);

    function loginUser() {
        const username = document.getElementById("user").value;
        const password = document.getElementById("contraseña").value;

        function checkCredentials(username, password) {
            const apiUrl = "https://localhost:7211/api/usuarios";
            const url = `${apiUrl}?username=${Usuario}&password=${Contraseña}`;
            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    return data.exists;
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }

        fetch('https://localhost:7211/api/usuarios', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })

            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Handle successful login response
                console.log(data);
            })
            .catch(error => {
                // Handle login error
                console.error('Error:', error);
            });
    }
</script>